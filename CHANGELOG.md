# 更新日志 (Changelog)

本文档记录 SubSyncForge 项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

## [1.3.7] - 2025-05-05

### 新增
- 实现了国内代理缓存和获取逻辑 (34e3eb6)。

### 优化
- 更新 `SubscriptionFetcher` 使用 ES6 导入，并增强 `sync-subscriptions` 中的代理处理 (d8c3451)。

### 修复
- 修复了 Rollup 构建配置，将 `node-fetch` 添加到外部依赖，解决了在 ES Module 环境下运行构建脚本时出现的 `ReferenceError: require is not defined` 错误 (a4279e2)。
- 优化 GitHub Actions 工作流，移除在没有文件变更时创建无效 `test.txt` 文件的行为，确保只有在实际发生文件变化时才进行提交和推送。

## [1.3.6] - 2025-04-29

### 新增
- **台湾地区节点配置**: 为台湾地区添加了 VLESS, Hysteria, SS, VMess, Trojan 等多种协议配置支持 (ad533c7)。

### 优化
- **同步通知增强**: 通知中增加与上次同步的节点数量对比，并改进了地区报告的准确性 (fdec1f7)。
- **项目清理**: 删除了与核心功能无关的测试脚本和运行产物文件，保持项目整洁。

## [1.3.5] - 2025-04-29

### 新增
- **高级节点过滤功能**
  - 支持按地区过滤节点（通过`filter_by_region`选项）
  - 支持按服务过滤节点（通过`filter_by_service`选项）
  - 添加地区文本列表生成功能（hk.txt, jp.txt, us.txt, sg.txt等）
  - 添加服务文本列表生成功能（openai.txt, disney.txt, netflix.txt等）

### 优化
- 改进配置文件处理逻辑，优化地区和服务标签识别
- 简化配置生成代码，提高性能和可读性
- 添加文本列表模板(txt_list.txt)，支持简单输出节点链接

### 修复
- 修复了特殊字符在节点名称中可能导致的解析错误

## [1.3.4] - 2025-04-28

### Changed
- **重构分组文件生成**: `generateGroupedNodeFiles` 函数现在直接输出节点分享链接到 `output/groups/*.txt` 文件，不再使用 Base64 编码，提高可读性。
- **修复 ES 模块导入**: 修正了多个文件中 `.js` 后缀缺失导致的模块导入错误，确保在严格执行 ESM 规范的环境（如 Node.js v22+）下正常运行。
- **修复 `trim` 函数错误**: 在 `generateGroupedNodeFiles` 中增加了对 `node.extra.raw` 的类型检查，避免了对非字符串类型调用 `trim()` 方法导致的运行时错误。

### Added
- 无

### Fixed
- 修复了因缺少 `.js` 后缀导致的多个模块无法找到的问题。
- 修复了 `generateGroupedNodeFiles` 中潜在的 `trim` 函数调用错误。

## [1.3.3] - 2024-07-27

### 改进

- 增强图标生成模块稳定性，即使在没有节点数据时也能正确生成图标
- 改进配置模板处理逻辑，增加对缺失模板文件和解析错误的异常处理
- 优化错误处理，提供更详细的错误提示信息

## [1.3.2] - 2023-07-26

### 新增
- **多IP地理位置API支持**
  - 集成多个免费IP地理位置API (ip-api.com, ipinfo.io, ipgeolocation.io, freegeoip.app)
  - 智能API切换机制，自动处理请求限制
  - 支持通过环境变量自定义API配置
  - 增强缓存系统，减少API请求次数

### 优化
- **Bark推送通知改进**
  - 减少推送频率，仅在重要事件发生时推送
  - 增加最小推送间隔，防止短时间内重复推送
  - 优化通知内容，显示更详细的更新信息
  - 更精确的变更检测和统计

### 文档
- 完善环境变量配置说明
- 添加详细的API配置指南
- 增加Bark通知设置教程

## [1.3.1] - 2023-07-25

### 新增
- **Bark推送通知功能**
  - 支持iOS/macOS设备通知
  - 通过环境变量配置Bark服务URL
  - 订阅更新完成后自动推送通知
  - 支持自定义通知标题和内容
  - 根据事件类型发送不同的通知
- **GitHub Actions 工作流优化**
  - 增强变更检测逻辑
  - 支持通过Bark推送更新内容详情
  - 自动识别配置文件和订阅文件变更

### 优化
- 增强日志系统，提供更详细的执行信息
- 更新项目文档，完善环境变量说明
- 优化脚本执行流程，提高稳定性

## [1.3.0] - 2025-05-01

### 新增
- **强大的规则系统**
  - 内置专业规则集
    - 应用/服务规则（如 Apple、Google、Microsoft）
    - 流媒体规则（如 Netflix、Disney+、YouTube）
    - AI 服务规则（如 OpenAI、Claude）
    - 广告拦截规则
    - 直连规则
  - 规则格式支持
    - DOMAIN / DOMAIN-SUFFIX / DOMAIN-KEYWORD
    - RULE-SET（支持远程规则集）
    - GEOIP
    - 复合规则（AND / OR / NOT）
  - 规则管理
    - 自动缓存远程规则集
    - 支持自定义规则
    - 规则优先级控制
- **高级分组模式**
  - 基于用户提供的专业分组标准
  - 主要选择组（节点切换、手动选择）
  - 应用/服务专用组（电报、OpenAI、流媒体等）
  - 区域节点组（香港、美国、新加坡等）
  - 特殊用途组（自建节点、全球直连等）

### 优化
- 改进了分组系统，支持多种分组模式
- 优化了规则应用逻辑，提高匹配效率
- 增强了缓存机制，减少网络请求

## [1.2.0] - 2025-04-25

### 新增
- **高级节点管理功能**
  - 智能节点分析和分类系统
    - 自动识别国家/地区（如 🇺🇸美国、🇭🇰香港）
    - 自动识别协议类型（如 VMess、Trojan、Hysteria2）
    - 自动识别节点编号（如 01、02）
    - 自动识别特殊标签（如 OpenAI、Netflix、流媒体）
  - 多维度节点分组
    - 按地区分组
    - 按协议分组
    - 按特殊标签分组
  - 自定义筛选规则
    - 支持复杂条件组合
    - 支持自定义分组规则
  - 图标支持
    - 国家/地区图标
    - 服务图标（如 Netflix、Disney+）
    - 协议图标
- 集成了 icons-all.json 资源，提供丰富的图标支持

### 优化
- 优化了节点命名规则，支持自定义格式
- 改进了分组逻辑，提供更直观的分组结构
- 增强了标签系统，支持更多特殊标签识别

### 修复
- 修复了某些特殊字符在节点名称中导致解析错误的问题
- 修复了部分协议识别不准确的问题

## [1.1.0] - 2025-04-25

### 新增
- **完整的错误处理和日志系统**
  - 分级日志记录（DEBUG, INFO, WARN, ERROR, FATAL）
  - 可配置日志处理器
  - 错误上下文追踪
  - 结构化日志输出
- **事件通知系统**
  - 转换过程事件通知
  - 自定义事件处理器
  - Webhook 支持
  - 异步事件处理
- **健壮性改进**
  - 智能重试机制
  - 数据验证层
  - 健康检查接口
  - 错误恢复能力
- **性能监控**
  - 详细的性能指标收集
  - 监控数据导出
  - 性能分析工具
  - 资源使用优化
- **API 文档**
  - 详细的 API 使用说明
  - 请求和响应示例
  - 错误码说明
- **开发指南**
  - 架构说明
  - 组件介绍
  - 开发流程
  - 示例代码

### 优化
- 改进了错误处理逻辑，提供更详细的错误信息
- 优化了日志输出格式，便于问题排查
- 增强了事件系统，支持更多事件类型

### 修复
- 修复了部分环境下日志记录失败的问题
- 修复了事件通知可能丢失的问题

## [1.0.0] - 2025-04-01

### 新增
- 初始版本发布
- 基本的订阅转换功能
  - 支持多种格式转换（V2Ray、Clash、Surge）
  - 节点去重功能
  - 基本的错误处理
- 简单的 API 接口
  - 订阅转换 API
  - 订阅列表 API
  - 状态 API
- 基本的文档
